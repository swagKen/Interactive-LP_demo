<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kimmy Live Room</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --bg-color: #000000;
            --primary-color: #00d2be; /* SWAG ç¶  */
            --live-red: #ff2d55;      /* ç›´æ’­ç´… */
            --text-white: #ffffff;
            --text-gray: #b9b9b9;
            --diamond-gold: #00d2be;  /* é…åˆä¸»è‰²ç³»çš„é‘½çŸ³è‰² */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            background-color: var(--bg-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--text-white);
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        /* --- æ‰‹æ©Ÿç‰ˆé¢æ¨¡æ“¬å®¹å™¨ --- */
        .app-container {
            width: 100%;
            max-width: 480px;
            height: 100%;
            background-color: #000;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* --- 1. ç›´æ’­èˆå°å±¤ --- */
        .live-stage {
            position: relative;
            flex: 1;
            width: 100%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #bgVideo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: blur(30px) brightness(0.7);
            z-index: 0;
            transform: scale(1.2);
        }

        #mainVideo {
            position: relative;
            width: 100%;
            height: 100%;
            object-fit: contain;
            z-index: 2;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .video-overlay-gradient {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 140px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
            z-index: 3;
            pointer-events: none;
        }
        
        .video-bottom-gradient {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 250px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            z-index: 3;
            pointer-events: none;
        }

        /* --- 2. é ‚éƒ¨ä»‹é¢å€åŸŸ --- */
        
        /* å·¦ä¸Šè§’ï¼šä¸»æ’­è³‡è¨Š (ä½ç½®ä¿®æ­£ï¼šèˆ‡å³ä¸Šè§’å¹³è¡Œ) */
        .streamer-info-container {
            position: absolute;
            top: 20px;  /* ä¿®æ­£ï¼šçµ±ä¸€é«˜åº¦ */
            left: 10px;
            z-index: 20;
            display: flex;
            align-items: center;
            max-width: 55%; /* ä¿®æ­£ï¼šé™åˆ¶å¯¬åº¦é¿å…é‡ç–Š */
        }

        .streamer-pill {
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            padding: 4px 12px 4px 4px; /* å³å´ç•™å¯¬ä¸€é» */
            border-radius: 24px;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
            width: 100%;
        }

        .streamer-avatar {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 8px;
            border: 2px solid var(--primary-color);
            flex-shrink: 0;
        }
        .streamer-avatar img { width: 100%; height: 100%; object-fit: cover; }

        .streamer-text { 
            display: flex; 
            flex-direction: column; 
            justify-content: center;
            margin-right: 8px; 
            overflow: hidden;
        }
        .streamer-name { 
            font-size: 12px; 
            font-weight: 700; 
            color: #fff; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .streamer-diamonds {
            font-size: 10px;
            color: var(--diamond-gold);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        /* è¿½è¹¤æŒ‰éˆ• */
        .follow-btn {
            background-color: var(--primary-color);
            color: #000;
            font-size: 10px;
            font-weight: 800;
            padding: 4px 10px;
            border-radius: 14px;
            border: none;
            flex-shrink: 0;
        }

        /* LIVE æ¨™ç±¤ */
        .live-badge {
            background: linear-gradient(45deg, #ff2d55, #ff5e3a);
            color: white;
            font-size: 8px;
            font-weight: 800;
            padding: 2px 5px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(255, 45, 85, 0.4);
            animation: pulse 2s infinite;
            margin-left: 6px;
            flex-shrink: 0;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* å³ä¸Šè§’ç¾¤çµ„ï¼šè§€çœ¾è³‡è¨Š + é—œé–‰æŒ‰éˆ• (ä½ç½®ä¿®æ­£ï¼šèˆ‡å·¦ä¸Šè§’å¹³è¡Œ) */
        .top-right-group {
            position: absolute;
            top: 25px; /* ä¿®æ­£ï¼šçµ±ä¸€é«˜åº¦ */
            right: 10px;
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 6px;
            max-width: 42%; /* ä¿®æ­£ï¼šé™åˆ¶å¯¬åº¦é¿å…é‡ç–Š */
            justify-content: flex-end;
        }

        /* è§€çœ¾è† å›Š */
        .viewer-pill {
            display: flex;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            padding: 3px 10px 3px 3px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            height: 34px;
            flex-shrink: 1;
            min-width: 0;
        }

        /* å­—æ¯é ­åƒå †ç–Š */
        .viewer-avatars {
            display: flex;
            margin-right: 6px;
            align-items: center;
            flex-shrink: 0;
        }

        .letter-avatar {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            color: #fff;
            font-size: 10px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0,0,0,0.2);
            margin-left: -8px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.3);
        }
        .letter-avatar:first-child { margin-left: 0; }

        .viewer-num { 
            font-size: 11px; 
            font-weight: bold; 
            color: #fff; 
            white-space: nowrap;
        }

        /* é—œé–‰æŒ‰éˆ• */
        .close-btn {
            width: 34px;
            height: 34px;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 16px;
            text-decoration: none;
            border: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            flex-shrink: 0;
        }

        /* --- 4. å³å´åŠŸèƒ½åˆ— --- */
        .right-sidebar {
            position: absolute;
            right: 15px;
            bottom: 40px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 20;
            align-items: center;
        }

        .side-btn {
            background: none;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: white;
            opacity: 0.95;
            transition: transform 0.1s;
            text-decoration: none;
        }
        .side-btn:active { transform: scale(0.9); }

        .icon-circle {
            width: 38px;
            height: 38px;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .side-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        /* --- 5. èŠå¤©å®¤ --- */
        .chat-container {
            position: absolute;
            bottom: 20px; 
            left: 15px;
            width: 70%;
            height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            mask-image: linear-gradient(to bottom, transparent, black 15%);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%);
        }
        .chat-container::-webkit-scrollbar { display: none; }

        .chat-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            animation: slideIn 0.3s ease-out;
        }

        .chat-avatar-img {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background-color: #555;
            color: #fff;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            flex-shrink: 0;
            border: 1px solid rgba(255,255,255,0.2);
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .chat-bubble {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 12px;
            border-top-left-radius: 2px;
            font-size: 13px;
            color: #fff;
            max-width: 100%;
            text-shadow: 0 1px 1px rgba(0,0,0,0.8);
            line-height: 1.4;
        }

        @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .username { color: rgba(255,255,255,0.7); font-weight: 600; font-size: 12px; margin-right: 4px; }
        .msg-content { color: #fff; }
        .sys-msg { color: var(--primary-color); font-weight: bold; }

        /* --- 6. åº•éƒ¨æ§åˆ¶é¢æ¿ --- */
        .control-panel {
            background-color: #1a1a1a;
            padding: 10px 15px 25px 15px;
            z-index: 30;
            border-top: 1px solid #333;
            flex-shrink: 0;
        }

        .balance-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 0 5px;
        }
        .balance-title { font-size:14px; color:#ffffff; font-weight:bold; }

        .balance-amount {
            font-size: 18px;
            font-weight: 800;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .add-btn { background: #333; width: 22px; height: 22px; border-radius: 50%; font-size: 16px; display: flex; align-items: center; justify-content: center; color: var(--primary-color); cursor: pointer; }

        .category-scroll {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .category-scroll::-webkit-scrollbar { display: none; }

        .cat-btn {
            background: #2a2a2a;
            border: 1px solid #3d3d3d;
            color: #ffffff;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cat-btn.active {
            background: rgba(0, 210, 190, 0.1);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            max-height: 140px;
            overflow-y: auto;
        }

        .action-btn {
            background: #252525;
            border: 1px solid #ffcc00;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .action-name { font-size: 13px; font-weight: bold; color: #fff; }
        .action-cost { font-size: 11px; color: var(--primary-color); margin-top: 2px;}
        .action-btn.disabled { opacity: 0.5; filter: grayscale(1); }
        .action-btn.disabled .action-cost { color: #d15b5b; }

        /* Modal */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-box {
            background: #2a2a2a; width: 80%; max-width: 300px; padding: 25px; border-radius: 16px;
            text-align: center; border: 1px solid #555; animation: popIn 0.3s ease;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-title { font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 10px; }
        .modal-desc { color: #aaa; font-size: 13px; margin-bottom: 20px; }
        .modal-btn { display: block; width: 100%; padding: 12px; background: var(--primary-color); color: #000; border-radius: 25px; font-weight: 800; text-decoration: none; margin-bottom: 10px;}
        .modal-close { background: none; border: none; color: #777; cursor: pointer; }

    </style>
</head>
<body>

<div class="app-container">
    
    <!-- 1. ç›´æ’­èˆå° -->
    <div class="live-stage">
        <video id="bgVideo" playsinline muted loop>
            <source src="" type="video/mp4">
        </video>
        <video id="mainVideo" playsinline autoplay muted loop>
            <source src="" type="video/mp4">
        </video>
        <div class="video-overlay-gradient"></div>
        <div class="video-bottom-gradient"></div>
        
        <div class="chat-container" id="chatContainer">
            <!-- ç³»çµ±è¨Šæ¯ -->
            <div class="chat-row">
                <div class="chat-bubble"><span class="sys-msg">æ­¡è¿ä¾†åˆ° kimmy_ilove ç›´æ’­é–“ï¼</span></div>
            </div>
        </div>

        <!-- å³å´æ‡¸æµ®åŠŸèƒ½åˆ— -->
        <div class="right-sidebar">
            <a href="https://swag.live/user/6598ea338c318119164a5352" class="side-btn">
                <div class="icon-circle">
                    <svg viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                </div>
            </a>
            <a href="https://swag.live/user/6598ea338c318119164a5352" class="side-btn">
                <div class="icon-circle">
                    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L3.16 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                </div>
            </a>
            <a href="https://swag.live/user/6598ea338c318119164a5352" class="side-btn">
                <div class="icon-circle">
                    <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                </div>
            </a>
            <button class="side-btn" id="soundBtn">
                <div class="icon-circle">
                    <svg id="muteIcon" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
                    <svg id="unmuteIcon" viewBox="0 0 24 24" style="display:none"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                </div>
            </button>
        </div>
    </div>

    <!-- 2. å·¦ä¸Šè§’ï¼šä¸»æ’­è³‡è¨Š -->
    <div class="streamer-info-container">
        <div class="streamer-pill" onclick="window.location.href='https://swag.live/user/6598ea338c318119164a5352'">
            <div class="streamer-avatar">
                <img src="https://res.cloudinary.com/dlg6ct7jj/image/upload/v1764327454/picture_utcrso.jpg" alt="Avatar">
            </div>
            <div class="streamer-text">
                <span class="streamer-name">kimmy_ilove</span>
                <!-- ä¸»æ’­é‘½çŸ³æ•¸ -->
                <span class="streamer-diamonds">ğŸ’ <span id="streamerDiamondDisplay">56,388</span></span>
            </div>
            <button class="follow-btn">+ è¿½è¹¤</button>
            <div class="live-badge">LIVE</div>
        </div>
    </div>

    <!-- 3. å³ä¸Šè§’ï¼šè§€çœ¾è³‡è¨Š -->
    <div class="top-right-group">
        <div class="viewer-pill">
            <div class="viewer-avatars">
                <div class="letter-avatar" style="background:#00d2be">K</div>
                <div class="letter-avatar" style="background:#ff2d55">J</div>
                <div class="letter-avatar" style="background:#ffcc00">A</div>
            </div>
            <!-- è§€çœ¾äººæ•¸ -->
            <span class="viewer-num" id="viewerCountDisplay">234</span>
        </div>
        <a href="https://swag.live" class="close-btn">âœ•</a>
    </div>

    <!-- 4. åº•éƒ¨æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <div class="balance-bar">
            <div class="balance-title">äº’å‹•èœå–®</div>
            <div class="balance-amount">
                ğŸ’ <span id="diamondDisplay">800</span>
                <div class="add-btn" onclick="openModal()">+</div>
            </div>
        </div>

        <div class="category-scroll">
            <button class="cat-btn active" onclick="switchCategory('menu')">ğŸ•¹ï¸ æŒ‘é€—è¡¨æ¼”</button>
            <button class="cat-btn" onclick="switchCategory('gift')">ğŸ è´ˆé€ç¦®ç‰©</button>
            <button class="cat-btn" onclick="switchCategory('private')">ğŸ­ ç§å¯†è¡¨æ¼”</button>
        </div>

        <div class="action-grid" id="actionContainer">
            <!-- JS Render -->
        </div>
    </div>

</div>

<!-- å„²å€¼å½ˆçª— -->
<div class="modal-overlay" id="rechargeModal">
    <div class="modal-box">
        <div style="font-size:40px; margin-bottom:10px">ğŸ’</div>
        <div class="modal-title">é‘½çŸ³ä¸å¤ å—ï¼Ÿ</div>
        <p class="modal-desc">è¶•å¿«å„²å€¼é‘½çŸ³<br> æˆ‘å€‘ç¹¼çºŒç©â¤ï¸ï¼</p>
        <a href="https://swag.live" class="modal-btn" target="_blank">ğŸ’° æŸ¥çœ‹å„²å€¼å„ªæƒ </a>
        <button class="modal-close" onclick="closeModal()">æˆ‘å†çœ‹çœ‹</button>
    </div>
</div>

<script>
    // ==========================================
    //  JS é‚è¼¯
    // ==========================================
    const DEFAULT_VIDEO = "https://res.cloudinary.com/dlg6ct7jj/video/upload/v1764326040/%E8%84%AB%E8%A1%A3_sprjda.mp4"; 
    let userDiamonds = 800;
    // åˆå§‹åŒ–æ•¸å€¼ä¿®æ­£
    let streamerDiamonds = 56388; 
    let viewerCount = Math.floor(Math.random() * (888 - 555 + 1)) + 555;

    const commandData = {
        "menu": [
            { name: "æ–å±è‚¡", price: 300, video: "https://res.cloudinary.com/dlg6ct7jj/video/upload/v1764326042/%E6%90%96%E5%B1%81%E8%82%A1_pruovu.mp4" },
            { name: "å£äº¤", price: 500, video: "https://res.cloudinary.com/dlg6ct7jj/video/upload/v1764326006/%E5%90%83%E6%A3%92%E6%A3%92_v1hwyl.mp4" },
            { name: "éœ‡å‹•è·³è›‹", price: 800, video: "https://www.w3schools.com/html/mov_bbb.mp4" },
            { name: "å™´æ°´", price: 1000, video: "https://www.w3schools.com/html/movie.mp4" }
        ],
        "gift": [
            { name: "å…”è€³æœµ", price: 69, video: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" },
            { name: "æ€§æ„Ÿä¸å­—è¤²", price: 699, video: "https://www.w3schools.com/html/mov_bbb.mp4" },
            { name: "ç«ç‘°èŠ±", price: 99, video: "https://www.w3schools.com/html/movie.mp4" },
            { name: "è·‘è»Š", price: 2999, video: "https://www.w3schools.com/html/mov_bbb.mp4" }
        ],
        "private": [
            { name: "ä¸€å°å¤šç§å¯†", price: 1000, link: "https://swag.live/livestream" },
            { name: "ä¸€å°ä¸€ç§å¯†", price: 2000, link: "https://swag.live/livestream" }
        ]
    };

    const fakeMessages = [
        { name: "Ken", msg: "å¤ªè¾£äº†å§ğŸ”¥" }, { name: "Elly", msg: "èº«æçœŸå¥½" },
        { name: "Suyu", msg: "å¯ä»¥çœ‹èƒŒé¢å—ï¼Ÿ" }, { name: "Syuto", msg: "ğŸ˜ğŸ˜ğŸ˜" },
        { name: "Henry", msg: "å·²æ–—å…§ï¼" }, { name: "Teresa", msg: "ä¸»æ’­æ™šä¸Šå¥½" },
        { name: "å°æ˜", msg: "é€™è…¿æˆ‘å¯ä»¥" }, { name: "Shawn", msg: "è²éŸ³å¥½ç”œ" }, 
        { name: "Matt", msg: "å¥½è‰²å–”" }, { name: "Sam", msg: "è²éŸ³å¥½ç”œ" }
    ];

    const mainVideo = document.getElementById('mainVideo');
    const bgVideo = document.getElementById('bgVideo');
    const actionContainer = document.getElementById('actionContainer');
    const diamondDisplay = document.getElementById('diamondDisplay');
    const streamerDiamondDisplay = document.getElementById('streamerDiamondDisplay'); 
    const viewerCountDisplay = document.getElementById('viewerCountDisplay'); 
    const rechargeModal = document.getElementById('rechargeModal');
    const chatContainer = document.getElementById('chatContainer');
    const soundBtn = document.getElementById('soundBtn');
    const muteIcon = document.getElementById('muteIcon');
    const unmuteIcon = document.getElementById('unmuteIcon');
    let currentCategory = 'menu'; 

    function init() {
        mainVideo.src = DEFAULT_VIDEO;
        bgVideo.src = DEFAULT_VIDEO;
        syncVideos();

        updateBalanceUI();
        updateStreamerBalanceUI();
        
        document.getElementById('viewerCountDisplay').textContent = viewerCount.toLocaleString();
        
        renderActions('menu');
        
        startFakeChat();
        startViewerCountSimulation(); 
        startStreamerDiamondSimulation(); 
        
        soundBtn.addEventListener('click', toggleSound);
    }

    function syncVideos() {
        mainVideo.addEventListener('play', () => bgVideo.play());
        mainVideo.addEventListener('pause', () => bgVideo.pause());
        mainVideo.addEventListener('seeking', () => bgVideo.currentTime = mainVideo.currentTime);
    }

    function toggleSound() {
        if(mainVideo.muted) {
            mainVideo.muted = false;
            bgVideo.muted = true;
            muteIcon.style.display = 'none';
            unmuteIcon.style.display = 'block';
        } else {
            mainVideo.muted = true;
            muteIcon.style.display = 'block';
            unmuteIcon.style.display = 'none';
        }
    }

    function updateBalanceUI() {
        diamondDisplay.textContent = userDiamonds.toLocaleString();
    }

    function updateStreamerBalanceUI() {
        streamerDiamondDisplay.textContent = streamerDiamonds.toLocaleString();
    }

    // --- è§€çœ¾äººæ•¸æ¨¡æ“¬é‚è¼¯ ---
    function startViewerCountSimulation() {
        setInterval(() => {
            const change = Math.floor(Math.random() * 6) + 5; 
            const isGrowth = Math.random() > 0.5; 
            
            if (isGrowth) {
                viewerCount += change;
            } else {
                viewerCount -= change;
            }
            
            viewerCountDisplay.textContent = viewerCount.toLocaleString();
        }, 2000); 
    }

    // --- ä¸»æ’­é‘½çŸ³æ¨¡æ“¬é‚è¼¯ ---
    function startStreamerDiamondSimulation() {
        setInterval(() => {
            const amounts = [100, 300, 500];
            const amount = amounts[Math.floor(Math.random() * amounts.length)];
            
            streamerDiamonds += amount;
            updateStreamerBalanceUI();
        }, 5000); 
    }

    window.switchCategory = function(category) {
        currentCategory = category;
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.classList.remove('active');
            if(btn.getAttribute('onclick').includes(category)) btn.classList.add('active');
        });
        renderActions(category);
    }

    function renderActions(category) {
        const items = commandData[category];
        actionContainer.innerHTML = ''; 
        items.forEach(item => {
            const btn = document.createElement('div');
            const isAffordable = userDiamonds >= item.price;
            let classes = 'action-btn';
            if (!isAffordable) classes += ' disabled';
            btn.className = classes;
            btn.onclick = () => handleActionClick(item, isAffordable);

            btn.innerHTML = `
                <div style="display:flex; flex-direction:row; align-items:center; gap:8px;">
                    <span class="action-name">${item.name}</span>
                    <span class="action-cost">ğŸ’ ${item.price.toLocaleString()}</span>
                </div>
            `;
            actionContainer.appendChild(btn);
        });
    }

    function handleActionClick(item, isAffordable) {
        if (!isAffordable) {
            openModal();
            return;
        }
        
        userDiamonds -= item.price;
        streamerDiamonds += item.price;

        updateBalanceUI();
        updateStreamerBalanceUI();
        
        renderActions(currentCategory); 
        addChatMessage("ç³»çµ±", `æ‚¨é€å‡ºäº† ${item.name}ï¼ä¸»æ’­å¾ˆé–‹å¿ƒ â¤ï¸`, true);

        if (item.video) {
            playCommandVideo(item.video);
        } else if (item.link) {
            window.location.href = item.link;
        }
    }

    function playCommandVideo(url) {
        mainVideo.src = url;
        bgVideo.src = url;
        const playPromise = mainVideo.play();
        if (playPromise !== undefined) {
            playPromise.then(_ => {
                bgVideo.play();
            }).catch(error => console.log("Auto-play blocked"));
        }
    }

    function openModal() { rechargeModal.style.display = 'flex'; }
    function closeModal() { rechargeModal.style.display = 'none'; }
    rechargeModal.addEventListener('click', (e) => {
        if(e.target === rechargeModal) closeModal();
    });

    let messagePool = [...fakeMessages]; // å»ºç«‹ä¸€å€‹å¡æ± 
    
    function startFakeChat() {
        setInterval(() => {
            // å¦‚æœå¡æ± ç©ºäº†ï¼Œé‡æ–°å¡«æ»¿
            if (messagePool.length === 0) {
                messagePool = [...fakeMessages];
            }

            // éš¨æ©Ÿé¸ä¸€å€‹
            const randomIndex = Math.floor(Math.random() * messagePool.length);
            
            // å–å‡ºä¸¦å¾æ± ä¸­ç§»é™¤
            const randomData = messagePool.splice(randomIndex, 1)[0];

            addChatMessage(randomData.name, randomData.msg);
        }, 3000);
    }

    const avatarColors = ['#ff2d55', '#00d2be', '#ffcc00', '#bd10e0', '#50e3c2', '#4a90e2', '#7ed321'];

    function addChatMessage(name, msg, isSystem = false) {
        const div = document.createElement('div');
        div.className = 'chat-row'; 
        
        if (isSystem) {
            div.innerHTML = `<div class="chat-bubble" style="border:1px solid #00d2be"><span class="sys-msg">${msg}</span></div>`;
        } else {
            const firstLetter = name.charAt(0).toUpperCase();
            const color = avatarColors[Math.floor(Math.random() * avatarColors.length)];
            
            div.innerHTML = `
                <div class="chat-avatar-img" style="background-color:${color}">${firstLetter}</div>
                <div class="chat-bubble">
                    <span class="username">${name}:</span>
                    <span class="msg-content">${msg}</span>
                </div>
            `;
        }
        
        chatContainer.appendChild(div);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        if (chatContainer.children.length > 50) chatContainer.removeChild(chatContainer.firstChild);
    }

    init();
</script>

</body>
</html>
